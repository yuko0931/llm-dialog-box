import{I as X,i as m,d as Y,r as d,u as ee,s as te,j as se,k as le,l as ae,m as U,c as v,a,b as K,q as j,F as x,e as S,w as b,v as ne,f as oe,x as I,n as ie,p as F,K as re,g as ue,y as ce,t as N,A as ve,z as de,o as i,_ as fe}from"./index-ClkyIdqs.js";import{L as T,s as he,c as pe,M as ge}from"./chat-Cx0dcxC-.js";import{i as ye,f as we,u as me,U as _e,r as ke}from"./index-Ds7f4lD7.js";const Ce=X("search",!0,function(r){return m("svg",{width:r.size,height:r.size,viewBox:"0 0 48 48",fill:"none"},[m("path",{d:"M21 38C30.3888 38 38 30.3888 38 21C38 11.6112 30.3888 4 21 4C11.6112 4 4 11.6112 4 21C4 30.3888 11.6112 38 21 38Z",fill:r.colors[1],stroke:r.colors[0],"stroke-width":r.strokeWidth,"stroke-linejoin":r.strokeLinejoin},null),m("path",{d:"M26.657 14.3431C25.2093 12.8954 23.2093 12 21.0001 12C18.791 12 16.791 12.8954 15.3433 14.3431",stroke:r.colors[2],"stroke-width":r.strokeWidth,"stroke-linecap":r.strokeLinecap,"stroke-linejoin":r.strokeLinejoin},null),m("path",{d:"M33.2216 33.2217L41.7069 41.707",stroke:r.colors[0],"stroke-width":r.strokeWidth,"stroke-linecap":r.strokeLinecap,"stroke-linejoin":r.strokeLinejoin},null)])}),Le={class:"container"},xe={class:"dialog-container"},Se={class:"input-box"},be={class:"input-wrapper"},Me={key:0,class:"filearea-wrapper"},ze={class:"textarea-wrapper"},je={class:"button-wrapper"},Ie={key:1,class:"history-list"},Fe={class:"history-container"},Ae={class:"history-section"},Be={class:"history-items"},Ve=["onClick"],De={class:"item-text"},Ue=["onClick"],Ke={class:"history-section"},Ne={class:"history-items"},Te=["onClick"],qe={class:"item-text"},Ee=Y({__name:"InlineDialogBox",setup(r){const M=d(!1),h=d(""),A=d(""),c=d(null),y=d(null),p=d(!1),f=d([]),g=d(""),_=d(!1),k=d(!0),C=d(!1),q=ee(),{messages:o,conversation_id:L,isRegenerate:E,conversationList:w,detailMessageList:B}=te(q),H=d(["介绍一下Vercel的主要功能","如何使用Vercel CLI?","如何设置自定义域名?","如何进行团队协作?"]),O=se(()=>h.value?w.value.filter(t=>t.title.toLowerCase().includes(h.value.toLowerCase())):w.value),R=t=>{w.value=w.value.filter(e=>e.coversation_id!==t),localStorage.setItem("conversationList",JSON.stringify(w.value))},W=async t=>{if(L.value=t,h.value="",C.value=!0,g.value="",p.value=!1,_.value=!1,k.value=!0,f.value=[],console.log("switch to conversation:",t),t){const e=await de(t);B.value=e.data,console.log("coversation messages:",B.value);const l=Object.values(e.data.reduce((s,u)=>{var n;return(s[n=u.chat_id]||(s[n]=[])).push(u),s},{})).sort((s,u)=>s[0].created_at-u[0].created_at).flatMap(s=>s.sort((u,n)=>n.type==="answer"?-1:1));o.value=l.map(s=>{if(s.content_type==="object_string"){const u=JSON.parse(s.content);return ke(u)}else return{role:s.role,content:s.content,content_type:s.content_type}})}},$=t=>{t.target.classList.contains("dialog-overlay")&&(M.value=!1,L.value="",h.value="",o.value=[],C.value=!1)},V=async()=>{const t=h.value.trim();if(!t)return;console.log(t);const e=f.value;if(f.value=[],!C.value)try{const l=await ue();L.value=l.id,C.value=!0;const s={coversation_id:l.id,title:t,date:new Date};w.value.unshift(s),localStorage.setItem("conversationList",JSON.stringify(w.value))}catch(l){console.error("创建会话失败:",l);return}e.length>0?o.value.push({role:"user",content:t,files:e,content_type:"object_string"}):o.value.push({role:"user",content:t,content_type:"text"}),h.value="",await z(t,e)},z=async(t,e)=>{g.value="",p.value=!0,_.value=!1,k.value=!0,ce(()=>{var n;(n=c.value)==null||n.scrollTo({top:c.value.scrollHeight,behavior:"smooth"})});let l="text",s=t;const u=[];e.length>0&&(l="object_string",e.forEach(n=>{ye(n.name)?u.push({type:"image",file_id:n.id}):u.push({type:"file",file_id:n.id})}),u.push({type:"text",text:t}),s=u),console.log("final_query:",s),await he({final_query:s,content_type:l,conversation_id:L.value,callback:n=>{n.role==="assistant"&&!_.value&&(g.value+=n.content||"")},onChatCreated(n){A.value=n,console.log("chat created:",n)},isCancelled:()=>_.value}),_.value||(o.value.push({role:"assistant",content:g.value,content_type:"text"}),p.value=!1),console.log("cur messages:",o.value)},J=t=>{t.shiftKey||(t.preventDefault(),V())},Z=async()=>{_.value=!0;const t=await pe({conversation_id:L.value,chat_id:A.value});console.log("canceled chat info:",t),o.value.push({role:"assistant",content:g.value,content_type:"text"}),g.value="",p.value=!1},G=()=>{var t;console.log("上传附件中"),(t=y.value)==null||t.click()},P=async()=>{if(y.value&&y.value.files&&y.value.files.length>0){const t=Array.from(y.value.files);console.log("文件列表:",t);for(const e of t){if(f.value.find(s=>s.name===e.name)){console.log("不要上传重复的文件!");continue}f.value.push({id:"",name:e.name,size:we(e.size),isparsing:!1});const l=await me(e);f.value=f.value.map(s=>(s.name===e.name&&(s.isparsing=!0,s.id=l.id),s)),console.log("上传文件结果:",l),y.value.value=""}}},Q=t=>{const e=f.value.findIndex(l=>l.name===t);e!==-1&&f.value.splice(e,1)},D=()=>{c.value&&(c.value.scrollTop+c.value.clientHeight<c.value.scrollHeight-30?k.value=!1:k.value=!0)};return le(()=>{c.value&&c.value.addEventListener("scroll",D)}),ae(()=>{c.value&&c.value.addEventListener("scroll",D)}),U(g,()=>{c.value&&k.value&&(c.value.scrollTop=c.value.scrollHeight)}),U(()=>E.value,async()=>{const t=o.value[o.value.length-2].content;o.value.pop();let e=[];o.value[o.value.length-1].content_type==="object_string"&&(e=o.value[o.value.length-1].files),await z(t,e)}),(t,e)=>(i(),v(x,null,[a("div",Le,[a("button",{class:"launcher",onClick:e[0]||(e[0]=l=>M.value=!0)},[m(j(Ce),{size:"18",style:{height:"16px",width:"16px",margin:"0 10px"}}),e[2]||(e[2]=a("span",null,"请输入要询问的问题",-1))])]),M.value?(i(),v("div",{key:0,class:"dialog-overlay",onClick:$},[a("div",xe,[a("div",Se,[a("div",be,[f.value.length>0?(i(),v("div",Me,[(i(!0),v(x,null,S(f.value,(l,s)=>(i(),v("div",{key:s},[m(_e,{name:l.name,size:l.size,isparsing:l.isparsing,onDeleteFile:Q},null,8,["name","size","isparsing"])]))),128))])):K("",!0),a("div",ze,[b(a("textarea",{"onUpdate:modelValue":e[1]||(e[1]=l=>h.value=l),name:"input-area",placeholder:"请输入要询问的问题",id:"input-area",onKeydown:oe(J,["enter"])},null,544),[[ne,h.value]])]),a("div",je,[a("input",{ref_key:"fileInput",ref:y,type:"file",multiple:"",accept:".doc,.docx,.xls,.xlsx,.ppt,.pptx,.pdf,.csv,.jpg,.png,.gif,.webp,.bmp,.pcd,.tiff",style:{display:"none"},onChange:P},null,544),a("div",{class:"attach btn",onClick:G},e[3]||(e[3]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 20",fill:"none"},[a("path",{d:"M7 20c-1.856-.002-3.635-.7-4.947-1.94C.74 16.819.003 15.137 0 13.383V4.828a4.536 4.536 0 0 1 .365-1.843 4.75 4.75 0 0 1 1.087-1.567A5.065 5.065 0 0 1 3.096.368a5.293 5.293 0 0 1 3.888 0c.616.244 1.174.6 1.643 1.05.469.45.839.982 1.088 1.567.25.586.373 1.212.364 1.843v8.555a2.837 2.837 0 0 1-.92 2.027A3.174 3.174 0 0 1 7 16.245c-.807 0-1.582-.3-2.158-.835a2.837 2.837 0 0 1-.92-2.027v-6.22a1.119 1.119 0 1 1 2.237 0v6.22a.777.777 0 0 0 .256.547.868.868 0 0 0 .585.224c.219 0 .429-.08.586-.224a.777.777 0 0 0 .256-.546V4.828A2.522 2.522 0 0 0 7.643 3.8a2.64 2.64 0 0 0-.604-.876 2.816 2.816 0 0 0-.915-.587 2.943 2.943 0 0 0-2.168 0 2.816 2.816 0 0 0-.916.587 2.64 2.64 0 0 0-.604.876 2.522 2.522 0 0 0-.198 1.028v8.555c0 1.194.501 2.339 1.394 3.183A4.906 4.906 0 0 0 7 17.885a4.906 4.906 0 0 0 3.367-1.319 4.382 4.382 0 0 0 1.395-3.183v-6.22a1.119 1.119 0 0 1 2.237 0v6.22c-.002 1.754-.74 3.436-2.052 4.677C10.635 19.3 8.856 19.998 7 20z",fill:"currentColor"})],-1)])),b(a("div",{class:ie(["send btn",h.value.trim()?"active":""]),onClick:V},e[4]||(e[4]=[a("svg",{width:"14",height:"16",viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7 16c-.595 0-1.077-.462-1.077-1.032V1.032C5.923.462 6.405 0 7 0s1.077.462 1.077 1.032v13.936C8.077 15.538 7.595 16 7 16z",fill:"currentColor"}),a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M.315 7.44a1.002 1.002 0 0 1 0-1.46L6.238.302a1.11 1.11 0 0 1 1.523 0c.421.403.421 1.057 0 1.46L1.838 7.44a1.11 1.11 0 0 1-1.523 0z",fill:"currentColor"}),a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.685 7.44a1.11 1.11 0 0 1-1.523 0L6.238 1.762a1.002 1.002 0 0 1 0-1.46 1.11 1.11 0 0 1 1.523 0l5.924 5.678c.42.403.42 1.056 0 1.46z",fill:"currentColor"})],-1)]),2),[[I,!p.value]]),b(a("div",{class:"stop btn",onClick:Z},e[5]||(e[5]=[a("div",{class:"box"},null,-1)]),512),[[I,p.value]])])])]),C.value?(i(),v("div",{key:0,class:"chat-list",ref_key:"chatListRef",ref:c},[(i(!0),v(x,null,S(j(o),(l,s)=>(i(),v("div",{key:s},[l.role==="user"?(i(),F(ge,{key:0,message:l.content,files:l.files||[],onGenerateChat:z},null,8,["message","files"])):(i(),F(T,{key:1,answer:l.content,isStreaming:p.value,isLast:s===j(o).length-1},null,8,["answer","isStreaming","isLast"]))]))),128)),(i(),F(re,null,[b(m(T,{answer:g.value,isStreaming:p.value},null,8,["answer","isStreaming"]),[[I,p.value]])],1024))],512)):(i(),v("div",Ie,[a("div",Fe,[a("div",Ae,[e[7]||(e[7]=a("div",{class:"section-title"},"最近记录",-1)),a("div",Be,[(i(!0),v(x,null,S(O.value,({coversation_id:l,title:s})=>(i(),v("div",{class:"history-item",key:l,onClick:u=>W(l)},[a("span",De,N(s),1),a("span",{class:"delete-btn",onClick:ve(u=>R(l),["stop"])},e[6]||(e[6]=[a("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M2.4 12L0 9.6L3.6 6L0 2.4L2.4 0L6 3.6L9.6 0L12 2.4L8.4 6L12 9.6L9.6 12L6 8.4L2.4 12Z",fill:"currentColor"})],-1)]),8,Ue)],8,Ve))),128))])]),a("div",Ke,[e[8]||(e[8]=a("div",{class:"section-title"},"建议提示",-1)),a("div",Ne,[(i(!0),v(x,null,S(H.value,(l,s)=>(i(),v("div",{class:"history-item",key:s,onClick:u=>h.value=l},[a("span",qe,N(l),1)],8,Te))),128))])])])]))])])):K("",!0)],64))}}),We=fe(Ee,[["__scopeId","data-v-d1746c1f"]]);export{We as default};
